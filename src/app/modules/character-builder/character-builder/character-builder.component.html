<mat-drawer-container [hasBackdrop]="false">
  <mat-drawer mode="over" #drawer [position]="'end'">

    <div fxLayout="column" fxLayoutAlign="space-around center">
      <div class="summary-title">
        <mat-panel-title>Build Summary</mat-panel-title>
        <br>
      </div>
      <div class="build-name-title">
        <mat-panel-title>{{ this.characterBuilderForm.get('buildName').value }}</mat-panel-title>
        <br>
      </div>

      <div fxLayout="row" class="build-summary-by-numbers">
        <div fxLayout="column">
          <div class="build-stats">
            <table mat-table [dataSource]="abilityScoreDisplayData" class="mat-elevation-z8 base-ability-totals">
              <ng-container [matColumnDef]="column" *ngFor="let column of abilityScoreDisplayColumns">
                <td mat-cell *matCellDef="let element"> {{ element[column] }} </td>
              </ng-container>

              <tr mat-row *matRowDef="let row; columns: abilityScoreDisplayColumns;"></tr>
            </table>
          </div>

          <div class="class-levels">
            <table mat-table [dataSource]="this.getCharacterClassLevelsAsArray()" class="mat-elevation-z8 class-levels">
              <ng-container matColumnDef="level">
                <th mat-header-cell *matHeaderCellDef>Level</th>
                <td mat-cell *matCellDef="let classLevel"> {{ classLevel[0] }} </td>
              </ng-container>
              <ng-container matColumnDef="class">
                <th mat-header-cell *matHeaderCellDef>Class</th>
                <td mat-cell *matCellDef="let charClass"> {{ charClass[1].name }} </td>
              </ng-container>
              <ng-container matColumnDef="remove">
                <tr><th mat-header-cell *matHeaderCellDef></th></tr>
                <tr>
                  <td mat-cell *matCellDef="let row">
                    <button mat-icon-button color="accent" title="Remove class" (click)="this.removeClass(row)"><mat-icon>remove_circle</mat-icon></button>
                  </td>
                <tr>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="characterClassLevelsDisplayHeaders"></tr>
              <tr mat-row *matRowDef="let row; columns: characterClassLevelsDisplayHeaders;"></tr>
            </table>

            <br>Level Class Pairs: {{ this.classLevels | json }}

            <table mat-table [dataSource]="this.classLevels" class="mat-elevation-z8 class-levels">
              <ng-container matColumnDef="level">
                <th mat-header-cell *matHeaderCellDef>Level</th>
                <td mat-cell *matCellDef="let levelClassPair"> {{ levelClassPair.level }} </td>
              </ng-container>
              <ng-container matColumnDef="class">
                <th mat-header-cell *matHeaderCellDef>Class</th>
                <td mat-cell *matCellDef="let classLevel"> {{ classLevel.characterClass.name }} </td>
              </ng-container>
              <ng-container matColumnDef="remove">
                <tr><th mat-header-cell *matHeaderCellDef></th></tr>
                <tr>
                  <td mat-cell *matCellDef="let row">
                    <button mat-icon-button color="accent" title="Remove class" (click)="this.removeClass(row)"><mat-icon>remove_circle</mat-icon></button>
                  </td>
                <tr>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="characterClassLevelsDisplayHeaders"></tr>
              <tr mat-row *matRowDef="let row; columns: characterClassLevelsDisplayHeaders;"></tr>
            </table>

          </div>

        </div>
      </div>
    </div>

  </mat-drawer>
  <mat-drawer-content>

    <mat-horizontal-stepper [linear]="isLinear" #stepper>
      <mat-step [stepControl]="sourceSelectionForm">
        <form [formGroup]="sourceSelectionForm">
          <ng-template matStepLabel>Select Sources to Use</ng-template>

          <mat-chip-list selectable>
            <mat-chip #chip="matChip" (click)="specialSourceHandling(chip)"
                      *ngFor="let option of ['Core Only', 'SRD Only', this.selectAll ? 'Select none' : 'Select all']">
              {{option}}
            </mat-chip>
          </mat-chip-list>

          <div class="checkbox-list" fxLayout="column" fxLayoutAlign="space-evenly stretch">
            <mat-form-field *ngIf="this.allSources">
              <mat-chip-list selectable multiple formControlName="sourcesSelected">
                <mat-chip #chip="matChip" [color]="'warn'" (click)="chip.toggleSelected(true)"
                          [value]="source.sourceEnum"
                          *ngFor="let source of this.allSources">{{source.readable}}</mat-chip>
              </mat-chip-list>
            </mat-form-field>
          </div>

          <div>
            <button color="accent" mat-raised-button matStepperNext (click)="this.getCharacterBuilderFormSelectionValues()">Next: Create a Build
            </button>
          </div>

        </form>
      </mat-step>
      <mat-step [stepControl]="characterBuilderForm" label="Create a build">

        <form [formGroup]="characterBuilderForm">
          <div fxLayout="column" fxLayoutAlign="space-around start">
            <mat-form-field appearance="fill">
              <mat-label>Build name</mat-label>
              <input matInput formControlName="buildName">
            </mat-form-field>

            <div class="base-ability-scores" fxLayout="row" fxLayoutGap="15px">
              <div class="base-ability-score-input" *ngFor="let baseAbility of baseAbilities">
                <mat-form-field appearance="fill" *ngIf="this.baseAbilityStyle === 'manual'">
                  <mat-label>{{ baseAbility + ' Score' | titlecase }}</mat-label>
                  <input matInput formControlName="{{baseAbility + 'ScoreManual'}}">
                </mat-form-field>

                <mat-form-field appearance="fill" *ngIf="this.baseAbilityStyle === 'standardArray'">
                  <mat-select placeholder="Type" formControlName="{{baseAbility + 'ScoreStandardArray'}}">
                    <mat-option value="--">--</mat-option>
                    <mat-option *ngFor="let value of standardArrayOptions | async"
                                [value]="value.value" [disabled]="!value.isAllowed">
                      {{value.value}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

              </div>
              <mat-form-field appearance="fill">
                <mat-label>Ability score generation style</mat-label>
                <mat-select [(value)]="baseAbilityStyle">
                  <mat-option [value]="'manual'">Manual</mat-option>
                  <mat-option [value]="'standardArray'">Standard Array</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div fxLayout="row" fxLayoutGap="15px" fxLayoutAlign="space-around center">

              <mat-form-field appearance="fill">
                <mat-label>Add class levels</mat-label>
                <mat-select [(value)]="selectedClass" formControlName="characterClasses">
                  <mat-option [value]="characterClass" *ngFor="let characterClass of availableCharacterClasses">
                    {{ characterClass.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <div fxLayout="row">
                <button mat-flat-button color="accent" (click)="addSelectedClassToClassLevels()">Add class</button>
                <button mat-flat-button color="accent" (click)="launchCharacterLevelManager()">Launch class level manager</button>
              </div>

            </div>

          </div>

          <div>
            <button mat-button matStepperPrevious>Back</button>
            <button mat-flat-button color="accent" matStepperNext>Save build</button>
            <button mat-flat-button (click)="drawer.toggle()">Show summary</button>
          </div>
        </form>

      </mat-step>

      <mat-step>
        <ng-template matStepLabel>Done</ng-template>
        <p>You are now done.</p>
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button (click)="stepper.reset()">Reset</button>
        </div>
      </mat-step>
    </mat-horizontal-stepper>

  </mat-drawer-content>
</mat-drawer-container>
