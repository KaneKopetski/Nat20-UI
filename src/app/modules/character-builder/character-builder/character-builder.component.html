<mat-drawer-container [hasBackdrop]="false">
  <mat-drawer mode="over" #drawer [position]="'end'">

    <app-build-summary [characterBuilderForm]="this.characterBuilderForm"></app-build-summary>
    <button mat-flat-button (click)="drawer.toggle()">Toggle summary</button>

  </mat-drawer>
  <mat-drawer-content>

    <mat-horizontal-stepper [linear]="isLinear" #stepper>
      <mat-step [stepControl]="characterBuilderForm">

        <app-source-form [characterBuilderForm]="this.characterBuilderForm"></app-source-form>

      </mat-step>

      <mat-step [stepControl]="characterBuilderForm" label="Name your build">
        <form [formGroup]="characterBuilderForm" fxLayout="column" class="build-name-form">
        <mat-form-field appearance="fill" color="accent">
          <mat-label>Build name</mat-label>
          <input matInput formControlName="buildName" autocomplete="off">
        </mat-form-field>
          <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-flat-button color="accent" type="submit" matStepperNext>Next</button>
            <button mat-flat-button (click)="drawer.toggle()">Toggle summary</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="characterBuilderForm" label="Generate base ability scores">

        <form [formGroup]="characterBuilderForm">
          <div fxLayout="column" fxLayoutAlign="space-around start">

            <div class="base-ability-scores" fxLayout="row" fxLayoutGap="15px">
              <div class="base-ability-score-input" *ngFor="let baseAbility of baseAbilities">

                <mat-form-field appearance="fill" *ngIf="this.baseAbilityStyle === 'manual'">
                  <mat-label>{{ baseAbility + ' Score' | titlecase }}</mat-label>
                  <input matInput formControlName="{{baseAbility + 'ScoreManual'}}">
                </mat-form-field>

                <mat-form-field appearance="fill" *ngIf="this.baseAbilityStyle === 'standardArray'">
                  <mat-label>{{ baseAbility + ' Score' | titlecase }}</mat-label>
                  <mat-select formControlName="{{baseAbility + 'ScoreStandardArray'}}">
                    <mat-option value="--">--</mat-option>
                    <mat-option *ngFor="let value of standardArrayOptions | async"
                                [value]="value.value" [disabled]="!value.isAllowed">
                      {{value.value}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="fill" *ngIf="this.baseAbilityStyle === 'pointBuy'">
                  <mat-label>{{ baseAbility + ' Score' | titlecase }}</mat-label>
                  <input matInput formControlName="{{baseAbility + 'ScorePointBuy'}}" type="number" min="8" max="18">
                </mat-form-field>

                <div fxLayout="column">
                <mat-form-field appearance="fill" *ngIf="this.baseAbilityStyle === 'diceRolls'">
                  <mat-label>{{ baseAbility + ' Score' | titlecase }}</mat-label>
                  <input matInput formControlName="{{baseAbility + 'ScoreDiceRoll'}}">
                </mat-form-field>

                <button mat-raised-button *ngIf="this.baseAbilityStyle === 'diceRolls'" (click)="launchDiceRollModal(baseAbility)">
                  <mat-icon svgIcon="d20"></mat-icon>
                </button>
                </div>

              </div>

              <mat-form-field appearance="fill" *ngIf="this.baseAbilityStyle === 'pointBuy'">
                <mat-label>Point Total</mat-label>
                <input matInput formControlName="totalPointBuy">
              </mat-form-field>

              <mat-form-field appearance="fill">
                <mat-label>Ability score generation style</mat-label>
                <mat-select [(value)]="baseAbilityStyle" formControlName="abilityScoreGenerationMethod">
                  <mat-option [value]="'manual'">Manual</mat-option>
                  <mat-option [value]="'standardArray'">Standard/Elite Array</mat-option>
                  <mat-option [value]="'pointBuy'">Point Buy</mat-option>
                  <mat-option [value]="'diceRolls'">Dice Rolls</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

          </div>

          <div class="base-ability-score-buttons">
            <button mat-button matStepperPrevious>Back</button>
            <button mat-flat-button color="accent" matStepperNext>Next</button>
            <button mat-flat-button (click)="drawer.toggle()">Toggle summary</button>
          </div>
        </form>

      </mat-step>

      <mat-step [stepControl]="characterBuilderForm" label="Select your class levels">
        <app-class-level-manager [data]="this.characterBuilderForm"></app-class-level-manager>
      </mat-step>

      <mat-step>
        <ng-template matStepLabel>Done</ng-template>
        <p>You are now done.</p>
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button (click)="stepper.reset()">Reset</button>
        </div>
      </mat-step>
    </mat-horizontal-stepper>

    <span>{{this.characterBuilderForm.value | json}}</span>

  </mat-drawer-content>
</mat-drawer-container>
